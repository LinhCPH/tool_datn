#!/bin/bash


BLUE='\033[0;34m'
NC='\033[0m'
target=0

# Tên tệp lưu kết quả
result_file_wes="pro_pentesting.txt"

declare -A choices

choices[1]="MSRPC (Microsoft Remote Procedure Call) Pentesting"
choices[2]="RDP (Remote Desktop Protocol) Pentesting"
x[1]=false
x[2]=false




# Hàm cho mỗi công việc
function job2() {
    echo "-----------------------------MSRPC (Microsoft Remote Procedure Call)------------------------------------" > PRO_result.txt
    echo "kiểm tra các dịch vụ RPC (Remote Procedure Call) trên muc tieu" > PRO_result.txt
    nmap --script msrpc-enum -p 135 $target > PRO_result.txt
    impacket-rpcdump -port 135 $target | grep -E 'MS-RPRN|MS-PAR'
    echo "-----------------------------MSRPC (Microsoft Remote Procedure Call)------------------------------------" > PRO_result.txt
    
}

function job1() {
    echo "-----------------------------RDP (Remote Desktop Protocol) ------------------------------------" > PRO_result.txt
    echo "Kiểm tra mã hóa RDP" > PRO_result.txt
    nmap --script rdp-enum-encryption -p 3389 $target > PRO_result.txt
    echo "Kiểm tra thông tin NTLM RDP" > PRO_result.txt
    nmap --script rdp-ntlm-info -p 3389 $target > PRO_result.txt
    echo "Kiểm tra tất cả các kịch bản RDP" > PRO_result.txt
    nmap --script rdp* -p 3389 $target  > PRO_result.txt
    echo "-----------------------------RDP (Remote Desktop Protocol) ------------------------------------" > PRO_result.txt
}






#----------------------------CHON CHUC NANG -------------------------------------
optionPE(){
   		echo   "-----------------------------------------------------------------------"
   		echo "|                                                                    	|"
   		echo "|										|" 
   		echo "|                         PROTOCOL PENTESTING				|"
   		echo "|										|"
		echo "|										|"
   		echo   "-----------------------------------------------------------------------"
		echo ""
		echo ""
	  }


#----------------------------CHON CHUC NANG-------------------------------------
if [ "$target" = "0" ]; then
       echo -n "Nhap IP muc tieu [IP hoac domain]: "
       read target
    fi

	clear
	optionPE
	echo "Lua chon cac tinh nang can kiem tra."
	# Duyệt qua tất cả các công việc
	for i in "${!choices[@]}"; do

	    valid_choice=false
	    
	    while [ "$valid_choice" = false ]; do
		read -p "Bạn muốn kiểm tra '${choices[$i]}' không? (Y/N): " choice
		choice=$(echo "$choice" | tr '[:upper:]' '[:lower:]')
		
		case "$choice" in
		    [y])
		        echo "Executing '${choices[$i]}'"
		        x[$i]=true
		        valid_choice=true
		        ;;
		    [n])
		        valid_choice=true
		        ;;
		    *)
		        echo "Giá trị không hợp lệ. Chỉ nhập Y hoặc N."
		        ;;
		esac
	    done
	done


for i in "${!x[@]}"; do
    if [ "${x[$i]}" = true ]; then
        eval "job$i"
    fi
done
