#!/bin/bash


BLUE='\033[0;34m'
NC='\033[0m'
target=0

# Tên tệp lưu kết quả
result_file_wes="pe_pentesting.txt"

declare -A choices

choices[1]="Dumping Windows Password Hashes"
choices[2]="Iperius Backup Service Privilege Escalation"
choices[3]="ManageEngine ADSelfService Plus PrivEsc"
choices[4]="Outlook Reminder Privilege Escalation"
choices[5]="UAC Windows Privilege Escalation"
choices[6]="Windows Privilege Escalation"
x[1]=false
x[2]=false
x[3]=false
x[4]=false
x[5]=false
x[6]=false



# Hàm cho mỗi công việc
function job6() {
    echo "-----------------------------Dumping Windows Password Hashes------------------------------------" > VS_result.txt
    echo "Dang kiem tra su ton tai cua cac file..." 
    local checkfileDumping=0
    if [ -e "NTDS.dit" ];  then
          echo -e "\e[0mNTDS.dit...\e[34m\e[1mOK\e[21m\e[0m" 
        else
          echo -e "\e[0mNTDS.dit...\e[31m\e[1mNOT OK\e[21m\e[0m"
          checkfileDumping=$(($checkfileDumping + 1))
        fi
    if [ -e "config_SYSTEM" ];  then
          echo -e "\e[0mconfig_SYSTEM..\e[34m\e[1mOK\e[21m\e[0m"
        else
          echo -e "\e[0mconfig_SYSTEM...\e[31m\e[1mNOT OK\e[21m\e[0m"
          checkfileDumping=$(($checkfileDumping + 1))
        fi
    if [ "$checkfileDumping" -ne 0 ]; then
        echo "Dang thu thap thong tin hash password tren NTDS..." > VS_result.txt
        sleep 1
        impacket-secretsdump -ntds NTDS.dit -system config_SYSTEM LOCAL > VS_result.txt
       else
         echo "Khong du du lieu dau vao!" > VS_result.txt
	fi
	
    echo "-----------------------------Dumping Windows Password Hashes------------------------------------" > VS_result.txt
}

function job5() {
    echo "-----------------------------Iperius Backup Service Privilege Escalation------------------------------------"
    
    echo "-----------------------------Iperius Backup Service Privilege Escalation------------------------------------"
}

function job4() {
    echo "-----------------------------ManageEngine ADSelfService Plus PrivEsc------------------------------------"
    
    echo "-----------------------------ManageEngine ADSelfService Plus PrivEsc------------------------------------"
}

function job3() {
    echo "Executing Job 4"
}

function job2() {
    echo "Executing Job 5"
}

function job1() {
    echo "Executing Job 6"
}





#----------------------------CHON CHUC NANG -------------------------------------
optionPE(){
   		echo -e "-----------------------------------------------------------------------"
   		echo "|                                                                    	|"
   		echo "|										|" 
   		echo "|                   PRIVILEGE ESCALATION PENTESTING			|"
   		echo "|										|"
		echo "|										|"
   		echo -e "-----------------------------------------------------------------------"
		echo ""
		echo ""
	  }


#----------------------------CHON CHUC NANG-------------------------------------
if [ "$target" = "0" ]; then
       echo -n "Nhap IP muc tieu [IP hoac domain]: "
       read target
    fi

	clear
	optionPE
	echo "Lua chon cac tinh nang can kiem tra."
	# Duyệt qua tất cả các công việc
	for i in "${!choices[@]}"; do

	    valid_choice=false
	    
	    while [ "$valid_choice" = false ]; do
		read -p "Bạn muốn kiểm tra '${choices[$i]}' không? (Y/N): " choice
		choice=$(echo "$choice" | tr '[:upper:]' '[:lower:]')
		
		case "$choice" in
		    [y])
		        echo "Executing '${choices[$i]}'"
		        x[$i]=true
		        valid_choice=true
		        ;;
		    [n])
		        valid_choice=true
		        ;;
		    *)
		        echo "Giá trị không hợp lệ. Chỉ nhập Y hoặc N."
		        ;;
		esac
	    done
	done


for i in "${!x[@]}"; do
    if [ "${x[$i]}" = true ]; then
        eval "job$i"
    fi
done
